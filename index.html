<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Keyboard Layout Usage Analyzer</title>
  <!-- Fancy serif font -->
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #fbf1c7;
      --fg: #3c3836;
      --border: #3c3836;
      --light0: #f2e5bc;
      --light1: #ebdbb2;
      --bright-red: #fb4934;
    }
    body {
      background: var(--bg);
      color: var(--fg);
      font-family: 'Merriweather', serif;
      padding: 20px;
    }
    /* Layout: two columns (input + results), responsive */
    .main { display: flex; gap: 40px; }
    .input-panel { flex: 1; }
    .output-panel { flex: 2; }
    /* grid layout for keyboard sections */
    #layouts-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
    @media (max-width: 800px) {
      .main { flex-direction: column; }
    }
    textarea {
      width: 100%;
      margin-bottom: 10px;
      background: var(--light1);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 8px;
      color: var(--fg);
      font-family: inherit;
    }
    .layout {
      background: var(--light0);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 10px;
    }
    .layout h2 {
      margin-bottom: 5px;
      font-weight: 600;
    }
    h1 {
      font-weight: 700;
      margin-bottom: 20px;
    }
    .keyboard { }
    .row { display: flex; margin-bottom: 4px; }
    .row.second-row { margin-left: 16px; }
    .row.third-row { margin-left: 32px; }
    .key { width: 32px; height: 32px; border: 1px solid var(--border); display: flex; align-items: center; justify-content: center; margin-right: 4px; position: relative; user-select: none; font-size: 12px; color: var(--fg); }
    .key .count { position: absolute; bottom: 1px; right: 1px; font-size: 8px; color: var(--fg); }
    .finger-workload { display: grid; grid-template-columns: repeat(8, 1fr); gap: 4px; margin: 10px 0; }
    .finger-bar { height: 20px; border: 1px solid var(--border); border-radius: 2px; display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; padding: 2px; }
  </style>
</head>
<body>
  <h1>Keyboard Layout Usage Analyzer</h1>
  <div class="main">
    <div class="input-panel">
      <textarea id="text-input" rows="20" placeholder="Paste your text here..."></textarea>
      <details style="margin-top: 10px; font-size: 12px;">
        <summary style="cursor: pointer;">Finger Mapping Reference</summary>
        <div style="margin: 8px 0;">
          <strong>Left Hand:</strong><br>
          LP (Pinky): Q, A, Z<br>
          LR (Ring): W, S, X<br>
          LM (Middle): E, D, C<br>
          LI (Index): R, T, F, G, V, B<br>
          <br>
          <strong>Right Hand:</strong><br>
          RI (Index): Y, U, H, J, N, M<br>
          RM (Middle): I, K<br>
          RR (Ring): O, L<br>
          RP (Pinky): P, ;
        </div>
        <small><em>Mappings shown for QWERTY. Other layouts use same finger positions but different letters.</em></small>
      </details>
    </div>
    <div class="output-panel">
      <div id="layouts-container"></div>
    </div>
  </div>
  <script>
    const layouts = {
      "QWERTY": {
        rows: [
          ["Q","W","E","R","T","Y","U","I","O","P"],
          ["A","S","D","F","G","H","J","K","L"],
          ["Z","X","C","V","B","N","M"]
        ],
        fingerMap: {
          "q": "L4", "w": "L3", "e": "L2", "r": "L1", "t": "L1", "y": "R1", "u": "R1", "i": "R2", "o": "R3", "p": "R4",
          "a": "L4", "s": "L3", "d": "L2", "f": "L1", "g": "L1", "h": "R1", "j": "R1", "k": "R2", "l": "R3",
          "z": "L4", "x": "L3", "c": "L2", "v": "L1", "b": "L1", "n": "R1", "m": "R1"
        },
        homeKeys: {
          "L4": "a", "L3": "s", "L2": "d", "L1": "f", "R1": "j", "R2": "k", "R3": "l", "R4": ";"
        }
      },
      "Colemak": {
        rows: [
          ["Q","W","F","P","G","J","L","U","Y"],
          ["A","R","S","T","D","H","N","E","I","O"],
          ["Z","X","C","V","B","K","M"]
        ],
        fingerMap: {
          "q": "L4", "w": "L3", "f": "L2", "p": "L1", "g": "L1", "j": "R1", "l": "R1", "u": "R2", "y": "R3",
          "a": "L4", "r": "L3", "s": "L2", "t": "L1", "d": "L1", "h": "R1", "n": "R1", "e": "R2", "i": "R3", "o": "R4",
          "z": "L4", "x": "L3", "c": "L2", "v": "L1", "b": "L1", "k": "R1", "m": "R1"
        },
        homeKeys: {
          "L4": "a", "L3": "r", "L2": "s", "L1": "t", "R1": "n", "R2": "e", "R3": "i", "R4": "o"
        }
      },
      "Dvorak": {
        rows: [
          ["'", ",", ".", "P","Y","F","G","C","R","L"],
          ["A","O","E","U","I","D","H","T","N","S"],
          ["Q","J","K","X","B","M","W","V","Z"]
        ],
        fingerMap: {
          "'": "L4", ",": "L3", ".": "L2", "p": "L1", "y": "L1", "f": "R1", "g": "R1", "c": "R2", "r": "R3", "l": "R4",
          "a": "L4", "o": "L3", "e": "L2", "u": "L1", "i": "L1", "d": "R1", "h": "R1", "t": "R2", "n": "R3", "s": "R4",
          "q": "L4", "j": "L3", "k": "L2", "x": "L1", "b": "L1", "m": "R1", "w": "R1", "v": "R2", "z": "R3"
        },
        homeKeys: {
          "L4": "a", "L3": "o", "L2": "e", "L1": "u", "R1": "h", "R2": "t", "R3": "n", "R4": "s"
        }
      },
      "Colemak-SE": {
        rows: [
          ["Q","W","F","P","G","J","L","U","Y","Ö","Å"],
          ["A","R","S","T","D","H","N","E","I","O","Ä"],
          ["Z","X","C","V","B","K","M"]
        ],
        fingerMap: {
          "q": "L4", "w": "L3", "f": "L2", "p": "L1", "g": "L1", "j": "R1", "l": "R1", "u": "R2", "y": "R3", "ö": "R4", "å": "R4",
          "a": "L4", "r": "L3", "s": "L2", "t": "L1", "d": "L1", "h": "R1", "n": "R1", "e": "R2", "i": "R3", "o": "R4", "ä": "R4",
          "z": "L4", "x": "L3", "c": "L2", "v": "L1", "b": "L1", "k": "R1", "m": "R1"
        },
        homeKeys: {
          "L4": "a", "L3": "r", "L2": "s", "L1": "t", "R1": "n", "R2": "e", "R3": "i", "R4": "o"
        }
      }
    };

    function getKeyPosition(layout, key) {
      const upperKey = key.toUpperCase();
      const lowerKey = key.toLowerCase();
      for (let rowIndex = 0; rowIndex < layout.rows.length; rowIndex++) {
        let colIndex = layout.rows[rowIndex].indexOf(upperKey);
        if (colIndex === -1) {
          colIndex = layout.rows[rowIndex].indexOf(lowerKey);
        }
        if (colIndex !== -1) {
          return { row: rowIndex, col: colIndex };
        }
      }
      return null;
    }

    function calculateDistance(pos1, pos2) {
      if (!pos1 || !pos2) return 0;
      const rowDiff = pos2.row - pos1.row;
      const colDiff = pos2.col - pos1.col;
      return Math.sqrt(rowDiff * rowDiff + colDiff * colDiff);
    }

    function getColor(count, max) {
      // interpolate from light1 to bright red based on count ratio
      if (max === 0) return '#ebdbb2';
      const low = { r: 0xeb, g: 0xdb, b: 0xb2 };
      const high = { r: 0xfb, g: 0x49, b: 0x34 };
      const ratio = count / max;
      const r = Math.round(low.r + ratio * (high.r - low.r));
      const g = Math.round(low.g + ratio * (high.g - low.g));
      const b = Math.round(low.b + ratio * (high.b - low.b));
      return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
    }

    function analyze() {
      const text = document.getElementById("text-input").value.toLowerCase();
      const counts = {};
      for (const char of text) {
        if ((char >= 'a' && char <= 'z') || char === 'ä' || char === 'ö' || char === 'å') {
          counts[char] = (counts[char] || 0) + 1;
        }
      }
      const maxCount = Math.max(0, ...Object.values(counts));
      const totalCount = Object.values(counts).reduce((sum, v) => sum + v, 0);
      const container = document.getElementById("layouts-container");
      container.innerHTML = "";
      
      for (const [name, layout] of Object.entries(layouts)) {
        // Calculate finger distances
        const fingerDistances = { L4: 0, L3: 0, L2: 0, L1: 0, R1: 0, R2: 0, R3: 0, R4: 0 };
        const fingerCounts = { L4: 0, L3: 0, L2: 0, L1: 0, R1: 0, R2: 0, R3: 0, R4: 0 };
        let lastPositions = {};
        
        for (const char of text) {
          if (layout.fingerMap[char]) {
            const finger = layout.fingerMap[char];
            const homeKey = layout.homeKeys[finger];
            
            // Only count distance if it's not the home key
            if (char !== homeKey) {
              const currentPos = getKeyPosition(layout, char.toUpperCase());
              const homePos = getKeyPosition(layout, homeKey.toUpperCase());
              
              if (currentPos && homePos) {
                const distance = calculateDistance(homePos, currentPos);
                fingerDistances[finger] += distance;
              }
            }
            
            fingerCounts[finger]++;
          }
        }
        
        const totalDistance = Object.values(fingerDistances).reduce((sum, d) => sum + d, 0);
        
        const section = document.createElement("div");
        section.className = "layout";
        const title = document.createElement("h2");
        title.textContent = name;
        section.appendChild(title);
        
        // home row usage
        const homeKeys = layout.rows[1] || [];
        const homeCount = homeKeys.reduce((sum, k) => sum + (counts[k.toLowerCase()] || 0), 0);
        const homePct = totalCount > 0 ? (homeCount / totalCount * 100).toFixed(1) : '0.0';
        const info = document.createElement('p');
        info.textContent = `Home: ${homeCount}/${totalCount} (${homePct}%)`;
        info.style.fontSize = '12px';
        info.style.margin = '4px 0';
        section.appendChild(info);
        
        // finger effort metrics
        const effortInfo = document.createElement('div');
        effortInfo.innerHTML = `
          <p style="font-size: 12px; margin: 4px 0;"><strong>Distance: ${totalDistance.toFixed(1)} units</strong></p>
        `;
        section.appendChild(effortInfo);
        
        // visual finger workload bars
        const maxFingerDistance = Math.max(...Object.values(fingerDistances));
        const workloadDiv = document.createElement('div');
        workloadDiv.className = 'finger-workload';
        
        const fingerLabels = ['L4', 'L3', 'L2', 'L1', 'R1', 'R2', 'R3', 'R4'];
        const fingerNames = ['LP', 'LR', 'LM', 'LI', 'RI', 'RM', 'RR', 'RP'];
        
        fingerLabels.forEach((finger, index) => {
          const distance = fingerDistances[finger];
          const intensity = maxFingerDistance > 0 ? distance / maxFingerDistance : 0;
          const bar = document.createElement('div');
          bar.className = 'finger-bar';
          bar.style.backgroundColor = getColor(intensity * 100, 100);
          bar.textContent = `${fingerNames[index]}\n${distance.toFixed(1)}`;
          bar.style.whiteSpace = 'pre-line';
          bar.title = `${fingerNames[index]}: ${distance.toFixed(1)} units`;
          workloadDiv.appendChild(bar);
        });
        
        section.appendChild(workloadDiv);
        
        const keyboard = document.createElement("div");
        keyboard.className = "keyboard";
        layout.rows.forEach((rowKeys, rowIndex) => {
          const row = document.createElement("div");
          row.className = "row";
          if (rowIndex === 1) row.classList.add("second-row");
          if (rowIndex === 2) row.classList.add("third-row");
          rowKeys.forEach(key => {
            const count = counts[key.toLowerCase()] || 0;
            const keyDiv = document.createElement("div");
            keyDiv.className = "key";
            keyDiv.style.backgroundColor = getColor(count, maxCount);
            keyDiv.textContent = key;
            const countSpan = document.createElement("div");
            countSpan.className = "count";
            countSpan.textContent = count;
            keyDiv.appendChild(countSpan);
            row.appendChild(keyDiv);
          });
          keyboard.appendChild(row);
        });
        section.appendChild(keyboard);
        container.appendChild(section);
      }
    }

    // live update: analyze on input
    document.getElementById("text-input").addEventListener("input", analyze);
  </script>
</body>
</html>
